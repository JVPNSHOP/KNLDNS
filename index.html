<!doctype html>
<html lang="my">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KNLVPN DNS RECORD</title>
  <style>
    :root{
      --fg:#0f172a; --muted:#64748b; --line:#e2e8f0;
      --accent:#14b8a6; --accent-ink:#0d9488;
      --bg1:#ede9fe; --bg2:#fee2e2;
      --card:#ffffffc7; --card-tint:#f9fafb;
      --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
      --cf:#f38020;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--fg);
      background:
        radial-gradient(1500px 700px at 10% -10%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1400px 800px at 100% 20%, var(--bg2) 0%, transparent 55%),
        linear-gradient(160deg,#faf5ff 0%, #eef2ff 50%, #fff1f2 100%);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;
    }
    .wrap{width:100%;max-width:1040px;}
    .card{
      background:linear-gradient(180deg,var(--card) 0%,var(--card-tint) 100%);
      backdrop-filter:blur(14px); border:1px solid var(--line); border-radius:24px;
      box-shadow:0 20px 40px rgba(15,23,42,.12); padding:28px 24px;
    }
    h1{font-size:28px;margin-bottom:6px;letter-spacing:.3px}
    h2{font-size:22px;margin-bottom:10px;letter-spacing:.2px}
    .byline{color:var(--accent-ink);font-weight:800;margin-bottom:14px;font-size:15px}
    form{display:grid;gap:14px}
    .row{display:grid;gap:10px;grid-template-columns:180px 1fr;align-items:center}
    label{color:var(--muted);font-size:14px}
    input,select{
      width:100%;height:44px;padding:10px 12px;border:1px solid var(--line);border-radius:12px;
      font-size:16px;background:#fff;outline:none;transition:border-color .2s,box-shadow .2s;
    }
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(20,184,166,.15)}
    .btns{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap}
    button{
      height:44px;border-radius:12px;font-weight:700;letter-spacing:.2px;cursor:pointer;
      border:1px solid var(--accent); background:var(--accent); color:#fff;
      box-shadow:0 8px 20px rgba(20,184,166,.25); transition:.15s all; padding:0 14px;
    }
    button:hover{transform:translateY(-1px)}
    button.ghost{background:#fff;color:var(--accent);box-shadow:0 6px 12px rgba(20,184,166,.1)}
    .btn-mini{height:34px;padding:0 10px;border-radius:10px;font-weight:600}
    #msg,#lookupMsg,#searchMsg{
      margin-top:12px;padding:12px;border-radius:12px;border:1px solid var(--line);
      background:#f8fafc;min-height:44px;white-space:pre-wrap
    }
    @media(max-width:720px){.row{grid-template-columns:1fr}}
    .footer{
      text-align:center;margin-top:20px;font-size:13px;color:#0f172a;background:#ffffffd9;border:1px solid var(--line);
      border-radius:12px;padding:10px;box-shadow:0 8px 20px rgba(15,23,42,.05)
    }
    .msg-ok{border-color:var(--ok)!important;background:#ecfdf5!important}
    .msg-warn{border-color:var(--warn)!important;background:#fffbeb!important}
    .msg-err{border-color:var(--err)!important;background:#fef2f2!important}

    /* Cloudflare-like Toggle (small) */
    .switch{position:relative;display:inline-flex;align-items:center;gap:10px;cursor:pointer;user-select:none}
    .switch input{position:absolute;opacity:0;width:0;height:0}
    .slider{
      position:relative;width:44px;height:24px;border-radius:999px;background:#e5e7eb;border:1px solid #d1d5db;
      transition:background .2s,border-color .2s,box-shadow .2s; box-shadow:inset 0 2px 4px rgba(0,0,0,.06)
    }
    .slider::after{
      content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:999px;
      box-shadow:0 2px 6px rgba(0,0,0,.15);transition:left .2s
    }
    .switch input:checked + .slider{
      background:linear-gradient(180deg,rgba(243,128,32,.95) 0%,var(--cf) 100%);
      border-color:#f59e0b;box-shadow:0 4px 14px rgba(243,128,32,.35)
    }
    .switch input:checked + .slider::after{left:23px}
    .cf-note{font-size:12px;color:var(--muted)}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;color:#0f172a;background:#fff;margin-left:8px}

    /* Table */
    .table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:8px}
    .table thead th{text-align:left;font-size:12px;color:var(--muted);padding:0 10px}
    .table tbody tr{background:#fff;border:1px solid var(--line);border-radius:12px;overflow:hidden;box-shadow:0 4px 10px rgba(15,23,42,.05)}
    .table td{padding:10px;font-size:14px;vertical-align:middle}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
    .small{font-size:13px;color:var(--muted)}
    .row-actions{display:flex;gap:6px;flex-wrap:wrap}
    .inpt{height:34px;padding:6px 8px;border:1px solid var(--line);border-radius:8px;font-size:14px;width:100%}
    .sel{height:34px;padding:0 8px;border:1px solid var(--line);border-radius:8px;font-size:14px}
    .switch-mini .slider{width:38px;height:22px}
    .switch-mini .slider::after{width:16px;height:16px;top:3px;left:3px}
    .switch-mini input:checked + .slider::after{left:19px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- DNS Record -->
    <div class="card">
      <h1>KNLVPN DNS RECORD</h1>
      <p class="byline">Power By : Jue Htet</p>

      <form id="dnsForm" autocomplete="off">
        <div class="row">
          <label for="type">Type</label>
          <select id="type" required>
            <option value="A">A</option>
            <option value="AAAA">AAAA</option>
            <option value="CNAME">CNAME</option>
            <option value="TXT">TXT</option>
            <option value="MX">MX</option>
            <option value="NS">NS</option>
            <option value="CAA">CAA</option>
            <option value="HTTPS">HTTPS</option>
          </select>
        </div>

        <div class="row">
          <label for="host">Host</label>
          <input id="host" type="text" placeholder="sub (or sub.knlvpn.com)" required />
        </div>

        <div class="row">
          <label id="contentLabel" for="content">IPv4 Address</label>
          <input id="content" type="text" placeholder="e.g. 203.0.113.10" required />
        </div>

        <div class="row" id="prioRow" style="display:none">
          <label for="priority">Priority</label>
          <input id="priority" type="number" min="0" max="65535" placeholder="10 (MX only)" />
        </div>

        <div class="row">
          <label for="ttl">TTL</label>
          <select id="ttl">
            <option value="1">Auto</option>
            <option value="60">60</option>
            <option value="120">120</option>
            <option value="300" selected>300</option>
            <option value="600">600</option>
            <option value="1800">1800</option>
            <option value="3600">3600</option>
          </select>
        </div>

        <!-- Proxy toggle -->
        <div class="row" id="proxiedRow">
          <label for="proxied">Proxy through Cloudflare</label>
          <div>
            <label class="switch" aria-label="Proxy through Cloudflare">
              <input id="proxied" type="checkbox" checked />
              <span class="slider" aria-hidden="true"></span>
            </label>
            <span class="pill">A / AAAA / CNAME only</span>
            <div class="cf-note">Orange = proxied, Gray = DNS only</div>
          </div>
        </div>

        <div class="btns">
          <button type="submit">Add / Update</button>
          <button type="button" class="ghost" id="resetBtn">Reset</button>
        </div>
        <div id="msg"></div>

        <div class="small" style="margin-top:8px">
          Host ကို short (e.g. <span class="mono">app</span>) ရိုက်ရင် <span class="mono">app.knlvpn.com</span> လို append လုပ်ပေးမယ်။
        </div>
      </form>
    </div>

    <!-- Host to IP -->
    <div class="card" style="margin-top:18px">
      <h2>Host to IP <span class="small">(Lookup)</span></h2>
      <div class="row">
        <label for="lookupHost">Host</label>
        <input id="lookupHost" type="text" placeholder="sub (or full hostname)" />
      </div>
      <div class="btns" style="margin-top:12px">
        <button type="button" id="lookupBtn">Lookup</button>
        <button type="button" class="ghost" id="lookupReset">Clear</button>
      </div>
      <div id="lookupMsg"></div>
    </div>

    <!-- Cloudflare Search / Manage -->
    <div class="card" style="margin-top:18px">
      <h2>Cloudflare DNS Records (Search / Edit / Delete)</h2>
      <div class="row">
        <label for="cfName">Search</label>
        <input id="cfName" placeholder="Search by name or content (partial match)" />
      </div>
      <div class="row">
        <label for="cfType">Type</label>
        <select id="cfType">
          <option value="">(Any)</option>
          <option>A</option><option>AAAA</option><option>CNAME</option>
          <option>TXT</option><option>MX</option><option>NS</option>
          <option>CAA</option><option>HTTPS</option>
        </select>
      </div>
      <div class="btns">
        <button type="button" id="cfSearch">Search</button>
        <button type="button" class="ghost" id="cfClear">Clear</button>
      </div>
      <div id="searchMsg" class="small">အောက်က results က Cloudflare မှ တိုက်ရိုက် query လုပ်ထားတာပါ။</div>

      <table class="table" aria-label="Cloudflare search results">
        <thead>
          <tr>
            <th>Type</th><th>Name</th><th>Content</th><th>TTL</th><th>Proxy</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="cfBody"></tbody>
      </table>

      <div class="btns" style="justify-content:flex-end;margin-top:10px">
        <button class="ghost btn-mini" id="prevPage">Prev</button>
        <button class="ghost btn-mini" id="nextPage">Next</button>
      </div>
    </div>

    <div class="footer">
      Admin : <b>Jue Htet</b> မှာစေတနာဖြင့် ပြုလုပ်ပေးထားပါသည်
    </div>
  </div>

  <script>
    /* ===== Config (worker link) ===== */
    const ROOT = "knlvpn.com";
    const API_BASE = "https://knlvpn-dns.nainglin26464.workers.dev";
    const API_URL  = API_BASE + "/dns";

    /* ===== UI Refs ===== */
    const typeEl=document.getElementById("type"),
      hostEl=document.getElementById("host"),
      contentEl=document.getElementById("content"),
      contentLabel=document.getElementById("contentLabel"),
      prioRow=document.getElementById("prioRow"),
      priorityEl=document.getElementById("priority"),
      proxiedRow=document.getElementById("proxiedRow"),
      proxiedEl=document.getElementById("proxied"),
      ttlEl=document.getElementById("ttl"),
      msg=document.getElementById("msg");

    function setPlaceholders(){
      const t=typeEl.value;
      prioRow.style.display=(t==="MX")?"grid":"none";
      proxiedRow.style.display=(["A","AAAA","CNAME"].includes(t))?"grid":"none";
      const placeholders={
        "A":["IPv4 Address","e.g. 203.0.113.10"],
        "AAAA":["IPv6 Address","e.g. 2001:db8::1"],
        "CNAME":["Target Hostname","e.g. target.example.com"],
        "TXT":["TXT Value",'e.g. v=spf1 include:_spf.example ~all'],
        "MX":["Mail Server","e.g. mail.example.com"],
        "NS":["Nameserver Host","e.g. ns1.example.com"],
        "CAA":["CAA Value",'e.g. 0 issue "letsencrypt.org"'],
        "HTTPS":["Value","HTTPS record value"]
      };
      const p=placeholders[t]; contentLabel.textContent=p[0]; contentEl.placeholder=p[1];
    }
    typeEl.addEventListener("change",setPlaceholders); setPlaceholders();

    function normalizeHost(raw){
      const v=(raw||"").trim().replace(/\s+/g,"");
      if(!v)return"";
      if(v===ROOT||v.endsWith("."+ROOT))return v.toLowerCase();
      if(v.includes(".")) return v.toLowerCase();
      return (v+"."+ROOT).toLowerCase();
    }
    function show(kind,text,el=msg){
      el.textContent=text;
      el.classList.remove("msg-ok","msg-warn","msg-err");
      el.classList.add(kind==="ok"?"msg-ok":kind==="warn"?"msg-warn":"msg-err");
    }

    /* ===== Add/Update (POST /dns) ===== */
    document.getElementById("resetBtn").addEventListener("click",()=>{
      document.getElementById("dnsForm").reset(); setPlaceholders();
      msg.textContent=""; msg.className=""; hostEl.focus();
    });
    document.getElementById("dnsForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const type=typeEl.value.trim().toUpperCase(),
        name=normalizeHost(hostEl.value),
        content=contentEl.value.trim(),
        ttl=parseInt(ttlEl.value,10)||300,
        proxied=!!proxiedEl.checked;

      if(!name){show("err","❌ Host required");return;}
      if(!(name===ROOT||name.endsWith("."+ROOT))){show("err",`❌ Host must be under ${ROOT}`);return;}
      if(!content){show("err","❌ Content required");return;}

      const payload={type,name,content,ttl};
      if(type==="MX"){
        const p=parseInt(priorityEl.value,10);
        if(Number.isNaN(p)){show("err","❌ MX priority required");return;}
        payload.priority=p;
      }
      if(["A","AAAA","CNAME"].includes(type)) payload.proxied=proxied;

      show("warn","Processing…");
      try{
        const res=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
        const data=await res.json();
        if(data.success){
          const r=data.record||data.result||{};
          show("ok",`Done ✅ : ${(r.content||content)} → ${(r.name||name)} (${data.action||'create'})`);
          await runSearch();
        }else{
          show("err","❌ Error: "+(data.error||"Unknown"));
        }
      }catch(err){ show("err","❌ Network error: "+err.message); }
    });

    /* ===== Lookup (DoH) ===== */
    const lookupHostEl=document.getElementById("lookupHost");
    const lookupMsg=document.getElementById("lookupMsg");
    document.getElementById("lookupReset").addEventListener("click", ()=>{ lookupHostEl.value=""; lookupMsg.textContent=""; lookupMsg.className=""; });
    document.getElementById("lookupBtn").addEventListener("click", lookup);
    lookupHostEl.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); lookup(); }});
    async function doh(name,type){
      const url=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(name)}&type=${type}`;
      const res=await fetch(url,{headers:{accept:"application/dns-json"}});
      if(!res.ok) throw new Error(`DoH ${type} failed (${res.status})`);
      return res.json();
    }
    function formatAnswers(ans=[]){ return ans?.filter(a=>a?.data).map(a=>a.data)||[]; }
    async function lookup(){
      const name=normalizeHost(lookupHostEl.value);
      if(!name){show("err","❌ Host required",lookupMsg);return;}
      show("warn","Looking up…",lookupMsg);
      try{
        const [a4,a6]=await Promise.allSettled([doh(name,"A"),doh(name,"AAAA")]);
        const v4=(a4.status==="fulfilled")?formatAnswers(a4.value?.Answer):[];
        const v6=(a6.status==="fulfilled")?formatAnswers(a6.value?.Answer):[];
        if(v4.length===0 && v6.length===0){ show("err",`No A/AAAA answers for ${name}`,lookupMsg); return; }
        const lines=[]; if(v4.length) lines.push(`A (${v4.length}) → ${v4.join(", ")}`); if(v6.length) lines.push(`AAAA (${v6.length}) → ${v6.join(", ")}`);
        show("ok",`${name}\n${lines.join("\n")}`,lookupMsg);
      }catch(err){ show("err","❌ Lookup error: "+err.message,lookupMsg); }
    }

    /* ===== Cloudflare Search / Manage ===== */
    const cfName=document.getElementById("cfName");
    const cfType=document.getElementById("cfType");
    const cfBody=document.getElementById("cfBody");
    const searchMsg=document.getElementById("searchMsg");
    document.getElementById("cfClear").addEventListener("click",()=>{ cfName.value=""; cfType.value=""; page=1; runSearch(); });
    document.getElementById("cfSearch").addEventListener("click",()=>{ page=1; runSearch(); });
    document.getElementById("prevPage").addEventListener("click", ()=>{ if(page>1){ page--; runSearch(); }});
    document.getElementById("nextPage").addEventListener("click", ()=>{ page++; runSearch(); });

    let page=1;
    async function runSearch(){
      const params=new URLSearchParams();
      if(cfName.value.trim()) params.set("name", cfName.value.trim());
      if(cfType.value) params.set("type", cfType.value);
      params.set("page", String(page));
      params.set("per_page","50");
      searchMsg.textContent="Searching…"; searchMsg.className="msg-warn";

      try{
        const res=await fetch(`${API_URL}?${params.toString()}`,{method:"GET"});
        const data=await res.json();
        if(!data.success){ throw new Error(data.error||"Search failed"); }
        const rows=data.result||[];
        cfBody.innerHTML="";
        if(rows.length===0){
          cfBody.innerHTML=`<tr><td colspan="6" class="small">No records found on this page.</td></tr>`;
        }else{
          for(const r of rows){
            const tr=document.createElement("tr");
            tr.innerHTML = `
              <td class="cell-type"><span class="mono">${r.type||""}</span></td>
              <td class="cell-name mono">${r.name||""}</td>
              <td class="cell-content mono">${escapeHtml(r.content||"")}</td>
              <td class="cell-ttl">${r.ttl||""}</td>
              <td class="cell-prox">${(["A","AAAA","CNAME"].includes(r.type) && r.proxied)? "🟧 proxied":"⬜ DNS only"}</td>
              <td class="cell-act">
                <div class="row-actions">
                  <button class="btn-mini" data-act="edit" data-id="${r.id}">Edit</button>
                  <button class="btn-mini" data-act="load" data-id="${r.id}">Load</button>
                  <button class="btn-mini ghost" data-act="delete" data-id="${r.id}">Delete</button>
                </div>
              </td>`;
            tr.dataset.row = JSON.stringify(r);
            cfBody.appendChild(tr);
          }
        }
        searchMsg.textContent=`Page ${data.page||page} – ${rows.length} record(s)`; searchMsg.className="small";
      }catch(err){
        searchMsg.textContent="❌ "+err.message;
        searchMsg.className="msg-err";
      }
    }
    runSearch();

    // inline Edit helpers
    function typeSelectHTML(cur){
      const types=["A","AAAA","CNAME","TXT","MX","NS","CAA","HTTPS"];
      return `<select class="sel edit-type">
        ${types.map(t=>`<option value="${t}" ${t===cur?'selected':''}>${t}</option>`).join("")}
      </select>`;
    }
    function proxToggleHTML(checked){
      return `<label class="switch switch-mini">
        <input class="edit-prox" type="checkbox" ${checked?'checked':''} />
        <span class="slider"></span>
      </label>`;
    }
    function startEdit(tr, row){
      // prevent duplicate edit mode
      if(tr.dataset.editing==="1") return;
      tr.dataset.editing="1";

      tr.querySelector(".cell-type").innerHTML = typeSelectHTML(row.type||"A");
      tr.querySelector(".cell-name").innerHTML = `<input class="inpt edit-name" value="${escapeHtmlAttr(row.name||"")}" />`;
      tr.querySelector(".cell-content").innerHTML = `<input class="inpt edit-content" value="${escapeHtmlAttr(row.content||"")}" />`;
      tr.querySelector(".cell-ttl").innerHTML = `<input class="inpt edit-ttl" type="number" min="1" value="${row.ttl||300}" />`;

      const proxCell = tr.querySelector(".cell-prox");
      if(["A","AAAA","CNAME"].includes(row.type||"")){
        proxCell.innerHTML = proxToggleHTML(!!row.proxied);
      }else{
        proxCell.innerHTML = `<span class="small muted">—</span>`;
      }

      const actCell = tr.querySelector(".cell-act .row-actions");
      actCell.innerHTML = `
        <button class="btn-mini" data-act="save" data-id="${row.id}">Save</button>
        <button class="btn-mini ghost" data-act="cancel" data-id="${row.id}">Cancel</button>
      `;
    }
    function cancelEdit(tr, row){
      tr.dataset.editing="0";
      tr.querySelector(".cell-type").innerHTML = `<span class="mono">${row.type||""}</span>`;
      tr.querySelector(".cell-name").innerHTML = `${row.name||""}`;
      tr.querySelector(".cell-content").innerHTML = `${escapeHtml(row.content||"")}`;
      tr.querySelector(".cell-ttl").innerHTML = `${row.ttl||""}`;
      tr.querySelector(".cell-prox").innerHTML =
        (["A","AAAA","CNAME"].includes(row.type) && row.proxied) ? "🟧 proxied" : "⬜ DNS only";
      const actCell = tr.querySelector(".cell-act .row-actions");
      actCell.innerHTML = `
        <button class="btn-mini" data-act="edit" data-id="${row.id}">Edit</button>
        <button class="btn-mini" data-act="load" data-id="${row.id}">Load</button>
        <button class="btn-mini ghost" data-act="delete" data-id="${row.id}">Delete</button>
      `;
    }

    async function saveEdit(tr, row){
      const t = tr.querySelector(".edit-type").value;
      const nameRaw = tr.querySelector(".edit-name").value;
      const content = tr.querySelector(".edit-content").value.trim();
      const ttl = parseInt(tr.querySelector(".edit-ttl").value,10) || row.ttl || 300;
      const name = normalizeHost(nameRaw);

      if(!name){searchMsg.textContent="❌ Host required"; searchMsg.className="msg-err"; return;}
      if(!content){searchMsg.textContent="❌ Content required"; searchMsg.className="msg-err"; return;}

      const payload = { type:t, name, content, ttl };
      if(t==="MX"){
        // keep same priority if original had one, else default 10 (user can change later via Load+form if needed)
        payload.priority = (row.priority!=null) ? row.priority : 10;
      }
      if(["A","AAAA","CNAME"].includes(t)){
        const prox = tr.querySelector(".edit-prox");
        payload.proxied = prox ? !!prox.checked : false;
      }

      searchMsg.textContent="Saving…"; searchMsg.className="msg-warn";
      try{
        const res=await fetch(`${API_URL}/${row.id}`,{
          method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload)
        });
        const data=await res.json();
        if(!data.success) throw new Error(data.error||"Update failed");
        searchMsg.textContent="Updated ✅"; searchMsg.className="msg-ok";
        await runSearch();
      }catch(err){
        searchMsg.textContent="❌ "+err.message; searchMsg.className="msg-err";
      }
    }

    cfBody.addEventListener("click", async (e)=>{
      const btn=e.target.closest("button"); if(!btn) return;
      const act=btn.getAttribute("data-act");
      const tr=btn.closest("tr");
      const row=JSON.parse(tr.dataset.row||"{}");

      if(act==="load"){
        typeEl.value=row.type||"A"; setPlaceholders();
        hostEl.value=row.name||"";
        contentEl.value=row.content||"";
        ttlEl.value=String(row.ttl||300);
        if(["A","AAAA","CNAME"].includes(row.type||"")) proxiedEl.checked=!!row.proxied;
        if(row.type==="MX" && row.priority!=null){ priorityEl.value = row.priority; }
        show("ok","Loaded into form. Edit and click “Add / Update”.");
        window.scrollTo({top:0,behavior:"smooth"});
      }

      if(act==="edit"){
        startEdit(tr, row);
      }

      if(act==="cancel"){
        cancelEdit(tr, row);
      }

      if(act==="save"){
        await saveEdit(tr, row);
      }

      if(act==="delete"){
        if(!confirm(`Delete DNS record?\n${row.type} ${row.name} -> ${row.content}`)) return;
        searchMsg.textContent="Deleting…"; searchMsg.className="msg-warn";
        try{
          const res=await fetch(`${API_URL}/${row.id}`,{method:"DELETE"});
          const data=await res.json();
          if(!data.success) throw new Error(data.error||"Delete failed");
          searchMsg.textContent="Deleted ✅"; searchMsg.className="msg-ok";
          await runSearch();
        }catch(err){ searchMsg.textContent="❌ "+err.message; searchMsg.className="msg-err"; }
      }
    });

    /* ===== Utils ===== */
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])); }
    function escapeHtmlAttr(s){ return String(s).replace(/"/g,'&quot;'); }
  </script>
</body>
</html>
